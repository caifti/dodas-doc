<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\-]+"><link rel="shortcut icon" href="../../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.0"><title>Recipe for impatient users - Dynamic On Demand Analysis Service</title><link rel="stylesheet" href="../../assets/stylesheets/application.4031d38b.css"><link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css"><meta name="theme-color" content=""><script src="../../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=swap"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../../assets/fonts/material-icons.css"></head><body dir="ltr" data-md-color-primary="deep-blue" data-md-color-accent="orange"><svg class="md-svg"><defs></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#recipe-for-impatient-users" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href="../.." title="Dynamic On Demand Analysis Service" class="md-header-nav__button md-logo"><i class="md-icon"></i></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">Dynamic On Demand Analysis Service</span><span class="md-header-nav__topic">Recipe for impatient users</span></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button" for="__search"></label><div class="md-search" data-md-component="search" role="dialog"><label class="md-search__overlay" for="__search"></label><div class="md-search__inner" role="search"><form class="md-search__form" name="search"><input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active"> <label class="md-icon md-search__icon" for="__search"></label> <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button></form><div class="md-search__output"><div class="md-search__scrollwrap" data-md-scrollfix><div class="md-search-result" data-md-component="result"><div class="md-search-result__meta">Type to start searching</div><ol class="md-search-result__list"></ol></div></div></div></div></div></div></div></nav></header><div class="md-container"><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href="../.." title="Dynamic On Demand Analysis Service" class="md-nav__button md-logo"><i class="md-icon"></i></a>Dynamic On Demand Analysis Service</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../.." title="Dynamic On Demand Analysis Service: DODAS" class="md-nav__link">Dynamic On Demand Analysis Service: DODAS</a></li><li class="md-nav__item"><a href="../../contacts/" title="Contact us" class="md-nav__link">Contact us</a></li><li class="md-nav__item"><a href="../../dodas-how-it-is-made/" title="DODAS: How it is made" class="md-nav__link">DODAS: How it is made</a></li><li class="md-nav__item"><a href="../../faq/" title="FAQ" class="md-nav__link">FAQ</a></li><li class="md-nav__item"><a href="../../introduction/" title="Introduction" class="md-nav__link">Introduction</a></li><li class="md-nav__item"><a href="../../known-issues/" title="Known Issues" class="md-nav__link">Known Issues</a></li><li class="md-nav__item"><a href="../../monitoring/" title="Monitoring" class="md-nav__link">Monitoring</a></li><li class="md-nav__item"><a href="../../the-enabling-facility/" title="The Enabling Facility" class="md-nav__link">The Enabling Facility</a></li><li class="md-nav__item"><a href="../../troubleshooting/" title="Troubleshooting" class="md-nav__link">Troubleshooting</a></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" checked><label class="md-nav__link" for="nav-10">Getting started</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-10">Getting started</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../" title="Getting Started" class="md-nav__link">Getting Started</a></li><li class="md-nav__item"><a href="../ams-recipe/" title="HTCondor AMS Recipe" class="md-nav__link">HTCondor AMS Recipe</a></li><li class="md-nav__item"><a href="../cms-recipe/" title="HTCondor CMS Recipe" class="md-nav__link">HTCondor CMS Recipe</a></li><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc"><label class="md-nav__link md-nav__link--active" for="__toc">Recipe for impatient users</label><a href="./" title="Recipe for impatient users" class="md-nav__link md-nav__link--active">Recipe for impatient users</a><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#141-registration" title="1) Registration" class="md-nav__link">1) Registration</a></li><li class="md-nav__item"><a href="#241-token-management" title="2) Token Management" class="md-nav__link">2) Token Management</a></li><li class="md-nav__item"><a href="#341-prepare-your-tosca-template" title="3) Prepare your TOSCA template" class="md-nav__link">3) Prepare your TOSCA template</a></li><li class="md-nav__item"><a href="#441-submit-the-tosca-template" title="4) Submit the TOSCA template" class="md-nav__link">4) Submit the TOSCA template</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#direct-submission-to-im" title="Direct submission to IM" class="md-nav__link">Direct submission to IM</a></li><li class="md-nav__item"><a href="#submission-to-the-paas-orchestrator" title="Submission to the PaaS Orchestrator" class="md-nav__link">Submission to the PaaS Orchestrator</a></li></ul></nav></li></ul></nav></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11"><label class="md-nav__link" for="nav-11">Using dodas with external providers</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-11">Using dodas with external providers</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../using-dodas-with-external-providers/" title="Using DODAS with external providers" class="md-nav__link">Using DODAS with external providers</a></li><li class="md-nav__item"><a href="../../using-dodas-with-external-providers/how-to-use-a-public-cloud/" title="How to use a public IaaS with DODAS-PaaS" class="md-nav__link">How to use a public IaaS with DODAS-PaaS</a></li><li class="md-nav__item"><a href="../../using-dodas-with-external-providers/how-to-use-your-own-cloud/" title="How to use private IaaS with DODAS-PaaS" class="md-nav__link">How to use private IaaS with DODAS-PaaS</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#141-registration" title="1) Registration" class="md-nav__link">1) Registration</a></li><li class="md-nav__item"><a href="#241-token-management" title="2) Token Management" class="md-nav__link">2) Token Management</a></li><li class="md-nav__item"><a href="#341-prepare-your-tosca-template" title="3) Prepare your TOSCA template" class="md-nav__link">3) Prepare your TOSCA template</a></li><li class="md-nav__item"><a href="#441-submit-the-tosca-template" title="4) Submit the TOSCA template" class="md-nav__link">4) Submit the TOSCA template</a><nav class="md-nav"><ul class="md-nav__list"><li class="md-nav__item"><a href="#direct-submission-to-im" title="Direct submission to IM" class="md-nav__link">Direct submission to IM</a></li><li class="md-nav__item"><a href="#submission-to-the-paas-orchestrator" title="Submission to the PaaS Orchestrator" class="md-nav__link">Submission to the PaaS Orchestrator</a></li></ul></nav></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><h1 id="recipe-for-impatient-users">Recipe for impatient users</h1>
<p>An impatient user seeking to try a DODAS deployment need to address the following 4 main steps: </p>
<h2 id="141-registration">1) Registration</h2>
<p>Register to the IAM-DODAS service by accessing the service <a href="https://dodas-iam.cloud.cnaf.infn.it/">here</a>. You can use your IdP because IAM-DODAS supports eduGAIN identity federation. <br />
The first registration will require the approval from the DODAS admins. </p>
<h2 id="241-token-management">2) Token Management</h2>
<p>Once your registration has been approved you can get your first DODAS token by using the recipe described and detailed <a href="https://indigo-iam.github.io/docs/v/current/user-guide/getting-a-token.html">here</a>. As you can see there are two options currently supported although we consider the password flow deprecated. We strongly suggest the Device code Flow for all the reasons detailed. Note that for the Device code flow, you need to configure the following in the Client (self-generated) management<a href="https://dodas-iam.cloud.cnaf.infn.it/manage/dev/dynreg"> dashboard</a>: <em>Access -&gt; grant_types -&gt; token</em>.</p>
<ul>
<li>For a <strong>very impatient user:</strong> just download and execute this <a href="https://gist.github.com/andreaceccanti/5b69323b89ce08321e7b5236de503600">script</a>. </li>
<li>
<p>Please note </p>
<ul>
<li>The script requires that you have a client (authorized for Device-Flow). You can either have your client (self-service generated) or use a client provided by DODAS team. In both cases before running the script you need to know the following information:  </li>
</ul>
<p><code>text
  IAM_DEVICE_CODE_CLIENT_ID
  IAM_DEVICE_CODE_CLIENT_SECRET
  IAM_DEVICE_CODE_ENDPOINT
  IAM_TOKEN_ENDPOINT</code></p>
<ul>
<li>There will be a few steps to address. The script will guide you.</li>
<li>You can set IAM_DEVICE_CODE_ENDPOINT="<a href="https://dodas-iam.cloud.cnaf.infn.it/devicecode">https://dodas-iam.cloud.cnaf.infn.it/devicecode</a>" and IAM_TOKEN_ENDPOINT="<a href="https://dodas-iam.cloud.cnaf.infn.it/token">https://dodas-iam.cloud.cnaf.infn.it/token</a>" in the script. Client ID and secret are given when you create the Device code flow client as explained <a href="https://indigo-iam.github.io/docs/v/current/user-guide/getting-a-token.html">above</a>.</li>
<li>There are two kinds of token: </li>
<li><em>access token</em>: short-lived. This is used in the steps below to obtain resources.</li>
<li><em>refresh token</em>: long-lived. Used to refresh the access token without going through device authorization in browser. See for example this <a href="https://github.com/andreaceccanti/indigo-aai-tutorial/blob/master/scripts/get-access-token.sh">script</a>.</li>
</ul>
</li>
</ul>
<h2 id="341-prepare-your-tosca-template">3) Prepare your TOSCA template</h2>
<p>At that point you can checkout the already available TOSCA Templates <a href="https://github.com/indigo-dc/tosca-templates/blob/master/dodas/">here</a> and pick the one you prefer. Otherwise just use the following simple TOSCA test to get a taste of the whole system (just replace os:properties:image: Ubuntu_16.04 with an existing image):</p>
<pre><code class="text">imports:
- indigo_custom_types: https://raw.githubusercontent.com/indigo-dc/tosca-types/master/custom_types.yaml
description: &gt;
 Launch a VM 
 Get IP and SSH credentials to access
 topology_template:
 node_templates:
   simple_node:
     type: tosca.nodes.indigo.Compute
     capabilities:
       endpoint:
         properties:
           network_name: PUBLIC
           ports:
             user_port:
               protocol: tcp
               source: 9000
             other_port:
               protocol: tcp
               source: 9001
       scalable:
         properties:
           count: 1
       host:
         properties:
           instance_type: m1.small
       os:
         properties:
           image: Ubuntu_16.04
outputs:
   node_ip:
     value: { get_attribute: [ simple_node, public_address, 0 ] }
   node_creds:
     value: { get_attribute: [ simple_node, endpoint, credential, 0 ] }
</code></pre>

<p>If you will choose a specific template (not just the test once) you need to  properly configure it. Configuration parameters should be documented on each TOSCA template. </p>
<h2 id="441-submit-the-tosca-template">4) Submit the TOSCA template</h2>
<p>Once configured, you can submit the TOSCA either to the PaaS Orchestrator or directly to IM. As a start, and if no complicated cloud configurations are needed, we recommend to start with direct submission to IM.</p>
<h3 id="direct-submission-to-im"><strong>Direct submission to IM</strong></h3>
<p>The direct submission to IM can be done either via im-client or using the RESTful API. The <a href="http://imdocs.readthedocs.io/en/devel/client.html#">extended guide </a> provides all the recipes and information for installation and configuration of the CLI as well as the documentation of the REST APIs. However using the REST is highly suggested for the initial testing cause it guarantees a enormous flexibility, useful for a fast turnaround during tests. In any case the public endpoint is :</p>
<pre><code class="text">https://im.cloud.cnaf.infn.it:8800/infrastructures
</code></pre>

<p>And an example of REST based submission is</p>
<pre><code class="text">curl -k -H 'Content-type: text/yaml' -H &quot;Authorization: id = ost; type = OpenStack; host = https://horizon.cloud.cnaf.infn.it:5000/v3; username = indigo-dc; password = $IAM_ACCESS_TOKEN; tenant = oidc; auth_version = 3.x_oidc_access_token; service_region = regionOne;\nid = im; type = InfrastructureManager; token = $IAM_ACCESS_TOKEN&quot; -X POST http://im.cloud.cnaf.infn.it:8800/infrastructures --data-binary @&quot;&lt;YOUR_TOSCA&gt;.yaml&quot;
</code></pre>

<p>And the expected output should be something like:  </p>
<p><code>HTTP/1.1 200 OK   
Content-Length: 86   
Content-Type: text/uri-list  
Infid: 9b044cce-6424-11e8-bad9-0242ac120003   
Date: Wed, 30 May 2018 16:15:11 GMT Server: Cheroot/6.3.1</code><br />
<strong><code>http://im.cloud.cnaf.infn.it:8800/infrastructures/9b044cce-6424-11e8-bad9-0242ac120003</code></strong></p>
<p>To submit to BARI, please use the following curl:</p>
<pre><code class="text">curl -v -k -H 'Content-type: text/yaml' -H &quot;Authorization: id = os; type = OpenStack; host = https://cloud.recas.ba.infn.it:5000/; username = indigo-dc; password = $IAM_ACCESS_TOKEN; tenant = oidc; auth_version = 3.x_oidc_access_token; service_region = recas-cloud;\nid = im; type = InfrastructureManager; token = $IAM_ACCESS_TOKEN&quot; -i -X POST https://im.cloud.cnaf.infn.it:443/infrastructures --data-binary &quot;@tosca-templates/dodas/CMS-HTCondor-dodas.yaml&quot;
</code></pre>

<p>The above commands are based on POST (to create the infrastructure described in the TOSCA template), but you can also use GET (to list) or DELETE commands to manage the infrastructure that you have created. Please refer to the documentation linked <a href="http://imdocs.readthedocs.io/en/devel/REST.html">here</a>.</p>
<h3 id="submission-to-the-paas-orchestrator">Submission to the PaaS Orchestrator</h3>
<p>The Submission to the PaaS Orchestrator as well can be done both through the client and through the REST APIS. Here in this guide only the client based solution is taken into account. <br />
There are two steps: </p>
<ul>
<li>Installation the client called <strong>orchent</strong> following the <a href="https://indigo-dc.gitbooks.io/orchent/admin.html">recipe here</a>. Once installed...</li>
<li>Configuration and usage of the orchent client as described <a href="https://indigo-dc.gitbooks.io/orchent/user.html">here</a>. Be careful to the following notes:</li>
<li>Despite the possibility to use the oidc-client we suggest to the ORCHENT_TOKEN based solution as described in the guide.</li>
<li>
<p>Set the ORCHENT_URL env. variable using the endpoint as here below:   </p>
<p><code>text
export ORCHENT_URL=https://orchestrator.cloud.cnaf.infn.it/orchestrator</code></p>
</li>
<li>
<p>The submission command should look like the following   </p>
<p><code>text
orchent depcreate &lt;Your-TOSCA&gt;.yaml '{}'</code></p>
</li>
</ul>
<p>the parenthesis  '{}' can be used to pass the input parameter to the TOSCA. Although values can be filled in the template itself, the parenthesis must be left there otherwise you'll get an error. </p>
<ul>
<li>
<ul>
<li>The output of the deployment creation (<code>depcreate</code>) command will be something like the following   <code>Deployment [b8bdccf3-9be5-499f-aac2-664dc0726795]:   status: CREATE_IN_PROGRESS   creation time: 2018-06-16T15:58+0000   update time: 2018-06-16T15:58+0000   callback:    status reason:    task: NONE   CloudProviderName:    outputs:   {}    links:     self [https://orchestrator.cloud.cnaf.infn.it/orchestrator/deployments/b8bdccf3-9be5-499f-aac2-664dc0726795]     resources [https://orchestrator.cloud.cnaf.infn.it/orchestrator/deployments/b8bdccf3-9be5-499f-aac2-664dc0726795/resources]     template [https://orchestrator.cloud.cnaf.infn.it/orchestrator/deployments/b8bdccf3-9be5-499f-aac2-664dc0726795/template]</code></li>
</ul>
</li>
</ul>
<p>The above steps 1 to 3 are valid irrespective of which TOSCA template will be used. Templates available are HTCondor as batch system and Spark. Moreover there are Experiment specific customization, in particular <a href="https://dodas.gitbook.io/dynamic-on-demand-analysis-service/~/edit/drafts/-LFIXHRxcNpQzkRZsUnA/getting-started/recipe-for-impatient-users">CMS</a> and <a href="https://dodas.gitbook.io/dynamic-on-demand-analysis-service/~/edit/drafts/-LFIXHRxcNpQzkRZsUnA/getting-started/ams-recipe">AMS</a> recipes.</p>
<p>User can test all the recipes running on the freely accessible DODAS <a href="../../the-enabling-facility/">Enabling Facility</a>.</p></article></div></div></main><footer class="md-footer"><div class="md-footer-nav"><nav class="md-footer-nav__inner md-grid"><a href="../cms-recipe/" title="HTCondor CMS Recipe" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev"><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-back md-footer-nav__button"></i></div><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Previous</span>HTCondor CMS Recipe</span></div></a><a href="../../using-dodas-with-external-providers/" title="Using DODAS with external providers" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next"><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Next</span>Using DODAS with external providers</span></div><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i></div></a></nav></div><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright">powered by <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a></div></div></div></footer></div><script src="../../assets/javascripts/application.b260a35d.js"></script><script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script></body></html>